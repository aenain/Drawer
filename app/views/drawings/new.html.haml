.header
  = image_tag "/assets/magicalc.svg", id: 'logo'

.content
  .slide-panel
    .drawing-series
      .canvas-container.drawing.current
        %canvas{ width: 100, height: 100 }

      .canvas-container.drawing
        %canvas{ width: 100, height: 100 }

  .main-frame-container
    #main-frame.canvas-container.main.drawing.frame
      = canvas_navigation_tag(:previous, class: 'hidden')
      %canvas#sketch{ width: 100, height: 100 }
      = canvas_navigation_tag(:next)

  .actions
    = image_tag "/assets/do-the-magic.svg"

:javascript
  $(function() {
    doodle.saveCallback = function(response) {
      if (typeof response.redirect != "undefined")
        window.location.href = response.redirect;
    }

    function add_canvas() {
      var $canvas = $("<div class = 'canvas-container drawing'><canvas width = '100' height = '100'></canvas></div>");
      $canvas.appendTo($(".drawing-series"));
      return $canvas;
    }

    $(".drawing-series").css({ marginLeft: ($("#main-frame").offset().left - 5) + 'px' });

    $("#main-frame .next").click(function() {
      $(this).siblings(".previous").removeClass("hidden");
      var $current = $(".drawing-series .current").removeClass("current");
      var $next = $current.next().addClass("current");

      if ($next.next().size() == 0)
        if ($(".drawing-series .canvas-container").size() < 30)
          add_canvas();
        else
          $(this).addClass("hidden");

      $current.find("canvas")[0].getContext("2d").putImageData(doodle.context.getImageData(0, 0, doodle.width, doodle.height), 0, 0);
      doodle.context.putImageData($next.find("canvas")[0].getContext("2d").getImageData(0, 0, doodle.width, doodle.height), 0, 0);
      doodle.oldState = doodle.context.getImageData(0, 0, doodle.width, doodle.height);
 
      $("#sketch").hide();
      $(".drawing-series").animate({ marginLeft: '-=106px' }, 200, function() { $("#sketch").show(); });
    });

    $("#main-frame .previous").click(function() {
      $(this).siblings(".next").removeClass("hidden");
      var $current = $(".drawing-series .current").removeClass("current");
      var $prev = $current.prev().addClass("current");

      if ($prev.prev().size() == 0)
        $(this).addClass("hidden");

      $current.find("canvas")[0].getContext("2d").putImageData(doodle.context.getImageData(0, 0, doodle.width, doodle.height), 0, 0);
      doodle.context.putImageData($prev.find("canvas")[0].getContext("2d").getImageData(0, 0, doodle.width, doodle.height), 0, 0);
      doodle.oldState = doodle.context.getImageData(0, 0, doodle.width, doodle.height);

      $("#sketch").hide();
      $(".drawing-series").animate({ marginLeft: '+=106px' }, 200, function() { $("#sketch").show(); });
    });

  });